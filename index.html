<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TFPPL LAB - Process Intelligence</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
            background: #f0f0eb;
            min-height: 100vh;
            color: #333;
            padding: 0;
            margin: 0;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #1a2332 0%, #0d1520 100%);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #d4a12a 0%, #b8902a 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(212, 161, 42, 0.3);
        }

        .logo-icon-inner {
            width: 24px;
            height: 24px;
            border: 3px solid white;
            border-radius: 50%;
        }

        .logo-text h1 {
            font-size: 1.3em;
            font-weight: 700;
            color: #fff;
            letter-spacing: 0.5px;
        }

        .logo-text h1 .highlight {
            color: #d4a12a;
        }

        .admin-btn {
            background: linear-gradient(135deg, #d4a12a 0%, #b8902a 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 8px rgba(212, 161, 42, 0.3);
            transition: all 0.3s ease;
        }

        .admin-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(212, 161, 42, 0.4);
        }

        .admin-btn::before {
            content: '‚Ä¢';
            font-size: 1.5em;
        }

        /* Content Container */
        .content-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Section Title */
        .section-title {
            text-align: center;
            margin: 40px 0 10px;
        }

        .section-title h2 {
            font-size: 2.5em;
            font-weight: 700;
            color: #1e293b;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .section-subtitle {
            text-align: center;
            margin-bottom: 30px;
        }

        .factor-label {
            color: #d4a12a;
            font-size: 1em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        /* Toggle Buttons */
        .toggle-container {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: #e5e5e0;
            padding: 6px;
            border-radius: 50px;
        }

        .toggle-btn {
            flex: 1;
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-radius: 50px;
            color: #64748b;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .toggle-btn.active {
            background: linear-gradient(135deg, #d4a12a 0%, #b8902a 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(212, 161, 42, 0.3);
        }

        /* Form Section */
        .form-section {
            background: #fafaf8;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid #e0e0dc;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .form-label {
            color: #8B98A8;
            font-size: 0.8em;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
            display: block;
            font-weight: 600;
        }

        .form-control {
            width: 100%;
            background: #ffffff;
            border: 1px solid #d4d4d0;
            border-radius: 8px;
            padding: 14px;
            color: #1a1a1a;
            font-size: 1em;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            appearance: none;
        }

        .form-control:focus {
            outline: none;
            border-color: #d4a12a;
            background: white;
        }

        select.form-control {
            background-color: #ffffff;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 20px;
            padding-right: 40px;
        }

        /* Calculate Button */
        .calculate-btn {
            width: 100%;
            background: linear-gradient(135deg, #d4a12a 0%, #b8902a 100%);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 12px rgba(212, 161, 42, 0.3);
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(212, 161, 42, 0.4);
        }

        .calculate-btn:active {
            transform: translateY(0);
        }

        /* Result Box */
        .result-box {
            background: linear-gradient(135deg, #fef9e7 0%, #fef5d4 100%);
            border-radius: 16px;
            padding: 25px;
            margin-top: 25px;
            display: none;
            border: 2px solid #d4a12a;
        }

        .result-box.show {
            display: block;
            animation: slideUp 0.4s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(212, 161, 42, 0.15);
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            color: #64748b;
            font-size: 0.95em;
            font-weight: 500;
        }

        .result-value {
            color: #d4a12a;
            font-size: 1.3em;
            font-weight: 700;
        }

        /* Tabs */
        .tabs {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            padding: 20px;
            margin: 0 -20px;
            scrollbar-width: none;
            -ms-overflow-style: none;
            background: white;
            border-bottom: 1px solid #e5e5e0;
        }

        .tabs::-webkit-scrollbar {
            display: none;
        }

        .tab {
            min-width: 140px;
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #64748b;
            text-align: center;
            white-space: nowrap;
        }

        .tab.active {
            background: transparent;
            color: #d4a12a;
            border-bottom-color: #d4a12a;
        }

        .tab:hover {
            color: #d4a12a;
        }

        .calculator-section {
            display: none;
        }

        .calculator-section.active {
            display: block;
        }

        /* Timestamp */
        .timestamp {
            background: #fef9e7;
            padding: 15px;
            border-radius: 12px;
            margin-top: 15px;
            font-size: 0.9em;
            color: #1e293b;
            border-left: 3px solid #d4a12a;
        }

        .timestamp strong {
            color: #d4a12a;
        }

        /* History Section */
        .history-section {
            margin-top: 30px;
            display: none;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .history-header h3 {
            color: #1e293b;
            font-size: 1.2em;
        }

        .clear-history-btn {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
            border: 1px solid #dc2626;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .clear-history-btn:hover {
            background: rgba(239, 68, 68, 0.2);
        }

        .history-item {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 3px solid #d4a12a;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .ppm-value {
            color: #d4a12a;
            font-weight: 700;
            font-size: 1.1em;
        }

        .sample-from {
            color: #64748b;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .timestamp-text {
            color: #94a3b8;
            font-size: 0.85em;
            margin-top: 8px;
            line-height: 1.5;
        }

        /* Info Text */
        .info-text {
            background: #fef9e7;
            border-left: 3px solid #d4a12a;
            padding: 12px 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.9em;
            color: #64748b;
            font-style: italic;
        }

        /* Formula Display */
        .formula-display {
            background: linear-gradient(135deg, #e0f2fe 0%, #dbeafe 100%);
            border-left: 3px solid #3b82f6;
            padding: 12px 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 0.85em;
            color: #1e40af;
        }

        .formula-display strong {
            color: #1e40af;
            font-weight: 700;
        }

        /* Admin Lock Modal */
        .admin-lock {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .admin-lock.show {
            display: flex;
        }

        .admin-modal {
            background: white;
            border-radius: 20px;
            padding: 35px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border: 1px solid #e5e5e0;
        }

        .admin-modal h3 {
            color: #1e293b;
            margin-bottom: 25px;
            font-size: 1.5em;
            text-align: center;
        }

        .admin-modal input {
            width: 100%;
            padding: 15px;
            background: #fafaf8;
            border: 2px solid #e5e5e0;
            border-radius: 12px;
            color: #1e293b;
            font-size: 1em;
            margin-bottom: 20px;
        }

        .admin-modal input:focus {
            outline: none;
            border-color: #d4a12a;
        }

        .admin-modal-buttons {
            display: flex;
            gap: 10px;
        }

        .admin-modal button {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .admin-unlock-btn {
            background: linear-gradient(135deg, #d4a12a 0%, #b8902a 100%);
            color: white;
        }

        .admin-cancel-btn {
            background: #e5e5e0;
            color: #64748b;
        }

        /* Responsive */
        @media (max-width: 640px) {
            .header {
                padding: 15px;
            }

            .logo-text h1 {
                font-size: 1.2em;
            }

            .logo-text p {
                font-size: 0.65em;
            }

            .admin-btn {
                padding: 8px 16px;
                font-size: 0.85em;
            }

            .section-title h2 {
                font-size: 2em;
            }

            .content-container {
                padding: 0 15px;
            }

            .form-section {
                padding: 20px;
            }
        }

        @media (max-width: 400px) {
            .logo-icon {
                width: 40px;
                height: 40px;
            }

            .logo-icon-inner {
                width: 20px;
                height: 20px;
            }

            .logo-text h1 {
                font-size: 1em;
            }

            .logo-text p {
                font-size: 0.6em;
            }

            .admin-btn {
                padding: 6px 12px;
                font-size: 0.8em;
            }

            .section-title h2 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="logo-section">
            <div class="logo-icon">
                <span style="font-size: 28px;">üåΩ</span>
            </div>
            <div class="logo-text">
                <h1>STARCH PROCESS <span class="highlight">LAB</span></h1>
            </div>
        </div>
        <button class="admin-btn" onclick="showAdminPanel()">Admin Panel</button>
    </div>

    <!-- Tabs -->
    <div class="tabs">
        <div class="tab active" onclick="switchTab('protein')">Protein</div>
        <div class="tab" onclick="switchTab('fat')">Fat</div>
        <div class="tab" onclick="switchTab('so2')">SO2</div>
        <div class="tab" onclick="switchTab('ash')">Ash</div>
    </div>

    <div class="content-container">
        <!-- Protein Calculator -->
        <div id="protein-calculator" class="calculator-section active">
            <div class="section-title">
                <h2>PROTEIN</h2>
            </div>
            <div class="section-subtitle">
                <span class="factor-label">FACTOR: 6.25</span>
            </div>

            <div class="toggle-container">
                <button class="toggle-btn active" id="actual-btn" onclick="switchBasis('actual')">ACTUAL</button>
                <button class="toggle-btn" id="dry-btn" onclick="switchBasis('dry')">DRY</button>
            </div>

            <div class="form-section">
                <label class="form-label">Maize Byproduct</label>
                <select id="protein-product" class="form-control">
                    <option value="starch">Starch</option>
                    <option value="gluten">Gluten</option>
                    <option value="germ">Germ</option>
                    <option value="fiber">Fiber</option>
                </select>

                <label class="form-label">Burette Reading (ML)</label>
                <input type="number" id="protein-burette" class="form-control" placeholder="0.00" step="0.01">

                <label class="form-label">Blank Reading (ML)</label>
                <input type="number" id="protein-blank" class="form-control" placeholder="0.00" step="0.01">

                <label class="form-label">Sample Weight (G)</label>
                <input type="number" id="protein-sample" class="form-control" placeholder="0.00" step="0.01">

                <label class="form-label">H2SO4 Normality (N) üîí</label>
                <input type="number" id="protein-normality" class="form-control" value="0.1" step="0.0001" readonly>

                <div id="moisture-group" style="display: none;">
                    <label class="form-label">Moisture %</label>
                    <input type="number" id="protein-moisture" class="form-control" placeholder="0.00" step="0.01">
                </div>

                <div class="formula-display">
                    <strong>Formula (Actual):</strong> Protein % = [(Burette - Blank) √ó Normality √ó 14.007 √ó 100 √ó 6.25] / (Sample Weight √ó 1000)<br><br>
                    <strong>Formula (Dry):</strong> Protein % (Dry) = [Protein % (Actual) √ó 100] / (100 - Moisture %)
                </div>

                <button class="calculate-btn" onclick="calculateProtein()">Calculate</button>
            </div>

            <div id="protein-result" class="result-box"></div>
        </div>

        <!-- Fat Calculator -->
        <div id="fat-calculator" class="calculator-section">
            <div class="section-title">
                <h2>FAT</h2>
            </div>

            <div class="form-section">
                <label class="form-label">Maize Byproduct</label>
                <select id="fat-product" class="form-control">
                    <option value="starch">Starch</option>
                    <option value="gluten">Gluten</option>
                    <option value="germ">Germ</option>
                    <option value="fiber">Fiber</option>
                </select>

                <label class="form-label">Empty Container Weight (G)</label>
                <input type="number" id="fat-container" class="form-control" placeholder="0.00" step="0.01">

                <label class="form-label">Container + Fat Weight (G)</label>
                <input type="number" id="fat-container-fat" class="form-control" placeholder="0.00" step="0.01">

                <label class="form-label">Sample Weight (G)</label>
                <input type="number" id="fat-sample" class="form-control" placeholder="0.00" step="0.01">

                <button class="calculate-btn" onclick="calculateFat()">Calculate</button>
            </div>

            <div id="fat-result" class="result-box"></div>
        </div>

        <!-- SO2 Calculator -->
        <div id="so2-calculator" class="calculator-section">
            <div class="section-title">
                <h2>SO2</h2>
            </div>

            <div class="form-section">
                <label class="form-label">Sample From</label>
                <select id="so2-product" class="form-control">
                    <option value="">Select Sample Source</option>
                    <option value="Preparation Tank">Preparation Tank</option>
                    <option value="Steeping Vat">Steeping Vat</option>
                    <option value="Storage Tank">Storage Tank</option>
                </select>

                <label class="form-label">Burette Reading (ML)</label>
                <input type="number" id="so2-burette" class="form-control" placeholder="0.00" step="0.01">

                <label class="form-label">Iodine Normality üîí</label>
                <input type="number" id="so2-iodine" class="form-control" value="0.1" step="0.0001" readonly>

                <div class="formula-display">
                    <strong>Formula:</strong> SO‚ÇÇ (ppm) = Burette Reading √ó Iodine Normality √ó 32.032 √ó 100
                </div>

                <button class="calculate-btn" onclick="calculateSO2()">Calculate</button>
            </div>

            <div id="so2-result" class="result-box"></div>

            <div id="so2-history-section" class="history-section">
                <div class="history-header">
                    <h3>üìä Measurement History</h3>
                    <button class="clear-history-btn" onclick="clearSO2History()">Clear All</button>
                </div>
                <div id="so2-history"></div>
            </div>

            <!-- Admin Normality Settings -->
            <div id="normality-settings" style="display: none; margin-top: 30px;">
                <div style="background: white; border-radius: 12px; padding: 25px; border: 1px solid #e0e0dc;">
                    <h3 style="color: #1e293b; margin-bottom: 20px; font-size: 1.2em;">‚öôÔ∏è Change Normality Settings</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <label class="form-label">H2SO4 Normality (N) - for Protein</label>
                        <input type="number" id="admin-protein-normality" class="form-control" value="0.1" step="0.0001">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label class="form-label">Iodine Normality (N) - for SO2</label>
                        <input type="number" id="admin-so2-normality" class="form-control" value="0.1" step="0.0001">
                    </div>
                    
                    <button class="calculate-btn" onclick="saveNormality()">Save Normality Values</button>
                </div>
            </div>
        </div>

        <!-- Ash Calculator -->
        <div id="ash-calculator" class="calculator-section">
            <div class="section-title">
                <h2>ASH</h2>
            </div>

            <div class="form-section">
                <label class="form-label">Maize Byproduct</label>
                <select id="ash-product" class="form-control">
                    <option value="starch">Starch</option>
                    <option value="gluten">Gluten</option>
                    <option value="germ">Germ</option>
                    <option value="fiber">Fiber</option>
                </select>

                <label class="form-label">Empty Container Weight (G)</label>
                <input type="number" id="ash-container" class="form-control" placeholder="0.00" step="0.01">

                <label class="form-label">Container + Ash Weight (G)</label>
                <input type="number" id="ash-container-ash" class="form-control" placeholder="0.00" step="0.01">

                <label class="form-label">Sample Weight (G)</label>
                <input type="number" id="ash-sample" class="form-control" placeholder="0.00" step="0.01">

                <button class="calculate-btn" onclick="calculateAsh()">Calculate</button>
            </div>

            <div id="ash-result" class="result-box"></div>
        </div>
    </div>

    <!-- Admin Lock Modal -->
    <div id="admin-lock" class="admin-lock">
        <div class="admin-modal">
            <h3>üîê Admin Access</h3>
            <input type="password" id="admin-password" placeholder="Enter admin password">
            <div class="admin-modal-buttons">
                <button class="admin-cancel-btn" onclick="hideAdminPanel()">Cancel</button>
                <button class="admin-unlock-btn" onclick="checkAdminPassword()">Unlock</button>
            </div>
        </div>
    </div>

    <script>
        // Load data from localStorage on page load
        let so2History = JSON.parse(localStorage.getItem('so2History')) || [];
        let isAdminLoggedIn = JSON.parse(localStorage.getItem('isAdminLoggedIn')) || false;
        
        // Load saved normality values
        let savedProteinNormality = localStorage.getItem('proteinNormality') || '0.1';
        let savedSO2Normality = localStorage.getItem('so2Normality') || '0.1';
        
        // Initialize page with saved values
        window.addEventListener('DOMContentLoaded', function() {
            // Set normality values from localStorage
            document.getElementById('protein-normality').value = savedProteinNormality;
            document.getElementById('so2-iodine').value = savedSO2Normality;
            
            // Update SO2 history display
            updateSO2History();
            
            // If admin was logged in, keep fields editable and show settings
            if (isAdminLoggedIn) {
                document.getElementById('protein-normality').removeAttribute('readonly');
                document.getElementById('so2-iodine').removeAttribute('readonly');
                document.getElementById('normality-settings').style.display = 'block';
                document.getElementById('admin-protein-normality').value = savedProteinNormality;
                document.getElementById('admin-so2-normality').value = savedSO2Normality;
            }
        });

        // Tab Switching
        function switchTab(tabName) {
            // Update tab buttons
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // Update calculator sections
            const sections = document.querySelectorAll('.calculator-section');
            sections.forEach(section => section.classList.remove('active'));
            document.getElementById(tabName + '-calculator').classList.add('active');
        }

        // Protein Basis Switching
        function switchBasis(basis) {
            const actualBtn = document.getElementById('actual-btn');
            const dryBtn = document.getElementById('dry-btn');
            const moistureGroup = document.getElementById('moisture-group');

            if (basis === 'actual') {
                actualBtn.classList.add('active');
                dryBtn.classList.remove('active');
                moistureGroup.style.display = 'none';
            } else {
                actualBtn.classList.remove('active');
                dryBtn.classList.add('active');
                moistureGroup.style.display = 'block';
            }
        }

        // Admin Panel
        function showAdminPanel() {
            document.getElementById('admin-lock').classList.add('show');
        }

        function hideAdminPanel() {
            document.getElementById('admin-lock').classList.remove('show');
            document.getElementById('admin-password').value = '';
        }

        function checkAdminPassword() {
            const password = document.getElementById('admin-password').value;
            const correctPassword = 'admin123';
            
            if (password === correctPassword) {
                isAdminLoggedIn = true;
                localStorage.setItem('isAdminLoggedIn', JSON.stringify(true));
                
                // Enable normality fields
                document.getElementById('protein-normality').removeAttribute('readonly');
                document.getElementById('so2-iodine').removeAttribute('readonly');
                
                // Show normality settings section
                document.getElementById('normality-settings').style.display = 'block';
                document.getElementById('admin-protein-normality').value = savedProteinNormality;
                document.getElementById('admin-so2-normality').value = savedSO2Normality;
                
                alert('‚úÖ Admin access granted!\n\nYou can now:\n‚Ä¢ Edit H2SO4 Normality (Protein)\n‚Ä¢ Edit Iodine Normality (SO2)\n‚Ä¢ Use "Change Normality Settings" section below\n\nPassword: admin123');
                hideAdminPanel();
            } else {
                alert('‚ùå Incorrect password!\n\nPlease contact your administrator.');
                document.getElementById('admin-password').value = '';
            }
        }
        
        // Save Normality Function
        function saveNormality() {
            const proteinNormality = document.getElementById('admin-protein-normality').value;
            const so2Normality = document.getElementById('admin-so2-normality').value;
            
            if (!proteinNormality || !so2Normality) {
                alert('Please enter valid normality values');
                return;
            }
            
            // Save to localStorage
            localStorage.setItem('proteinNormality', proteinNormality);
            localStorage.setItem('so2Normality', so2Normality);
            
            // Update the actual input fields
            document.getElementById('protein-normality').value = proteinNormality;
            document.getElementById('so2-iodine').value = so2Normality;
            
            // Update saved values
            savedProteinNormality = proteinNormality;
            savedSO2Normality = so2Normality;
            
            alert('‚úÖ Normality values saved successfully!\n\nH2SO4 Normality: ' + proteinNormality + ' N\nIodine Normality: ' + so2Normality + ' N\n\nThese values will persist across sessions.');
        }

        // Protein Calculator
        function calculateProtein() {
            const product = document.getElementById('protein-product').value;
            const burette = parseFloat(document.getElementById('protein-burette').value);
            const blank = parseFloat(document.getElementById('protein-blank').value);
            const sample = parseFloat(document.getElementById('protein-sample').value);
            const normality = parseFloat(document.getElementById('protein-normality').value);
            const moisture = parseFloat(document.getElementById('protein-moisture').value) || 0;
            const basis = document.getElementById('actual-btn').classList.contains('active') ? 'actual' : 'dry';

            if (isNaN(burette) || isNaN(blank) || isNaN(sample) || isNaN(normality)) {
                alert('Please fill in all fields with valid numbers');
                return;
            }

            if (sample <= 0) {
                alert('Sample weight must be greater than 0');
                return;
            }

            if (basis === 'dry' && (isNaN(moisture) || moisture < 0 || moisture >= 100)) {
                alert('Please enter a valid moisture percentage (0-100)');
                return;
            }

            const factor = 6.25;
            const nitrogenPercent = ((burette - blank) * normality * 14.007 * 100) / (sample * 1000);
            const proteinActual = nitrogenPercent * factor;

            let proteinFinal = proteinActual;
            if (basis === 'dry') {
                proteinFinal = (proteinActual * 100) / (100 - moisture);
            }

            const resultBox = document.getElementById('protein-result');
            const basisText = basis === 'dry' ? 'Dry Basis' : 'Actual Basis';

            let resultHTML = `
                <div class="result-item">
                    <span class="result-label">Product:</span>
                    <span class="result-value">${product.charAt(0).toUpperCase() + product.slice(1)}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Calculation Basis:</span>
                    <span class="result-value">${basisText}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">H2SO4 Normality:</span>
                    <span class="result-value">${normality} N</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Nitrogen %:</span>
                    <span class="result-value">${nitrogenPercent.toFixed(4)}%</span>
                </div>
            `;

            if (basis === 'dry') {
                resultHTML += `
                    <div class="result-item">
                        <span class="result-label">Protein % (Actual):</span>
                        <span class="result-value">${proteinActual.toFixed(4)}%</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Moisture %:</span>
                        <span class="result-value">${moisture.toFixed(2)}%</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Protein % (Dry Basis):</span>
                        <span class="result-value">${proteinFinal.toFixed(4)}%</span>
                    </div>
                `;
            } else {
                resultHTML += `
                    <div class="result-item">
                        <span class="result-label">Protein % (Actual Basis):</span>
                        <span class="result-value">${proteinFinal.toFixed(4)}%</span>
                    </div>
                `;
            }

            resultHTML += `
                <div class="result-item">
                    <span class="result-label">Conversion Factor:</span>
                    <span class="result-value">${factor}</span>
                </div>
            `;

            resultBox.innerHTML = resultHTML;
            resultBox.classList.add('show');
        }

        // Fat Calculator
        function calculateFat() {
            const product = document.getElementById('fat-product').value;
            const container = parseFloat(document.getElementById('fat-container').value);
            const containerFat = parseFloat(document.getElementById('fat-container-fat').value);
            const sample = parseFloat(document.getElementById('fat-sample').value);

            if (isNaN(container) || isNaN(containerFat) || isNaN(sample)) {
                alert('Please fill in all fields with valid numbers');
                return;
            }

            if (sample <= 0) {
                alert('Sample weight must be greater than 0');
                return;
            }

            if (containerFat < container) {
                alert('Container + Fat weight must be greater than empty container weight');
                return;
            }

            const fatWeight = containerFat - container;
            const fatPercent = (fatWeight / sample) * 100;

            const resultBox = document.getElementById('fat-result');
            resultBox.innerHTML = `
                <div class="result-item">
                    <span class="result-label">Product:</span>
                    <span class="result-value">${product.charAt(0).toUpperCase() + product.slice(1)}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Fat Weight:</span>
                    <span class="result-value">${fatWeight.toFixed(4)} g</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Fat %:</span>
                    <span class="result-value">${fatPercent.toFixed(4)}%</span>
                </div>
            `;
            resultBox.classList.add('show');
        }

        // SO2 Calculator
        function calculateSO2() {
            const product = document.getElementById('so2-product').value;
            const burette = parseFloat(document.getElementById('so2-burette').value);
            const iodineNormality = parseFloat(document.getElementById('so2-iodine').value);

            if (!product || product === '') {
                alert('Please select a sample source');
                return;
            }

            if (isNaN(burette) || isNaN(iodineNormality)) {
                alert('Please fill in all fields with valid numbers');
                return;
            }

            const so2ppm = burette * iodineNormality * 32.032 * 100;

            const now = new Date();
            const dateOptions = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                weekday: 'long'
            };
            const timeOptions = {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            };
            const dateStr = now.toLocaleDateString('en-US', dateOptions);
            const timeStr = now.toLocaleTimeString('en-US', timeOptions);

            so2History.unshift({
                ppm: so2ppm.toFixed(2),
                date: dateStr,
                time: timeStr,
                burette: burette,
                iodineNormality: iodineNormality,
                sampleFrom: product
            });

            if (so2History.length > 10) {
                so2History.pop();
            }
            
            // Save to localStorage
            localStorage.setItem('so2History', JSON.stringify(so2History));

            const resultBox = document.getElementById('so2-result');
            resultBox.innerHTML = `
                <div class="result-item">
                    <span class="result-label">Sample From:</span>
                    <span class="result-value">${product}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">SO2 Concentration:</span>
                    <span class="result-value">${so2ppm.toFixed(2)} ppm</span>
                </div>
                <div class="timestamp">
                    <strong>üìÖ Test Date & Time:</strong><br>
                    ${dateStr}<br>
                    ${timeStr}
                </div>
            `;
            resultBox.classList.add('show');

            updateSO2History();
        }

        function updateSO2History() {
            const historySection = document.getElementById('so2-history-section');
            const historyContainer = document.getElementById('so2-history');

            if (so2History.length === 0) {
                historySection.style.display = 'none';
                return;
            }

            historySection.style.display = 'block';

            let historyHTML = '';
            so2History.forEach((item, index) => {
                historyHTML += `
                    <div class="history-item">
                        <div><strong>#${index + 1}</strong> - <span class="ppm-value">${item.ppm} ppm</span></div>
                        <div class="sample-from">üìç Sample From: ${item.sampleFrom}</div>
                        <div class="timestamp-text">
                            üìÖ ${item.date} at ${item.time}<br>
                            üìä Burette: ${item.burette} mL | Iodine Normality: ${item.iodineNormality} N
                        </div>
                    </div>
                `;
            });

            historyContainer.innerHTML = historyHTML;
        }

        function clearSO2History() {
            if (confirm('Are you sure you want to clear all SO2 measurement history?')) {
                so2History = [];
                localStorage.setItem('so2History', JSON.stringify(so2History));
                updateSO2History();
                alert('History cleared successfully!');
            }
        }
        
        // Admin Logout (optional - can be called from console if needed)
        function adminLogout() {
            if (confirm('Are you sure you want to logout from admin panel?')) {
                isAdminLoggedIn = false;
                localStorage.setItem('isAdminLoggedIn', JSON.stringify(false));
                
                // Make normality fields readonly again
                document.getElementById('protein-normality').setAttribute('readonly', 'readonly');
                document.getElementById('so2-iodine').setAttribute('readonly', 'readonly');
                
                // Hide normality settings
                document.getElementById('normality-settings').style.display = 'none';
                
                alert('‚úÖ Admin logged out successfully!');
            }
        }

        // Ash Calculator
        function calculateAsh() {
            const product = document.getElementById('ash-product').value;
            const container = parseFloat(document.getElementById('ash-container').value);
            const containerAsh = parseFloat(document.getElementById('ash-container-ash').value);
            const sample = parseFloat(document.getElementById('ash-sample').value);

            if (isNaN(container) || isNaN(containerAsh) || isNaN(sample)) {
                alert('Please fill in all fields with valid numbers');
                return;
            }

            if (sample <= 0) {
                alert('Sample weight must be greater than 0');
                return;
            }

            if (containerAsh < container) {
                alert('Container + Ash weight must be greater than empty container weight');
                return;
            }

            const ashWeight = containerAsh - container;
            const ashPercent = (ashWeight / sample) * 100;

            const resultBox = document.getElementById('ash-result');
            resultBox.innerHTML = `
                <div class="result-item">
                    <span class="result-label">Product:</span>
                    <span class="result-value">${product.charAt(0).toUpperCase() + product.slice(1)}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Ash Weight:</span>
                    <span class="result-value">${ashWeight.toFixed(4)} g</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Ash %:</span>
                    <span class="result-value">${ashPercent.toFixed(4)}%</span>
                </div>
            `;
            resultBox.classList.add('show');
        }

        // Allow Enter key to trigger password check
        document.getElementById('admin-password').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                checkAdminPassword();
            }
        });
    </script>
</body>
</html>
